name: Build and Push Docker Image

on: 
  push: 
    branches:
      - develop

jobs:
        
  update-rancher:
    name: Update Rancher Stacks
    runs-on: ubuntu-16.04
    steps:
    - uses: actions/checkout@v1
      with:
        repository: ${{ secrets.KARTOZA_RANCHER_SCRIPT_REPO }}
        ref: ${{ secrets.KARTOZA_RANCHER_SCRIPT_REF }}
    - uses: actions/setup-node@v1
    - name: npm install, run node script
      env:
        rancherAccessKey: ${{ secrets.RANCHER_ACCESS_KEY }}
        rancherSecretKey: ${{ secrets.RANCHER_SECRET_KEY }}
      working-directory: ../kartoza-rancher-scripts
      run: |
        npm install
