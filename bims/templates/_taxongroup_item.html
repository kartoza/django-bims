{% load site %}
{% is_user_expert user taxon_group.experts as user_is_expert %}

<li data-id="{{ taxon_group.id }}" data-name="{{ taxon_group.name }}"
    class="ui-state-default {% if user_is_expert %}taxon-group-expert{% endif %}">
  <div class="tg-item">
    <div class="row">
      <div class="col-sm-2 img-container">
        {% if taxon_group.logo %}
          <img src="{{ taxon_group.logo }}" alt="{{ taxon_group.name }} logo" loading="lazy"/>
        {% endif %}
      </div>

      <div class="col-sm-9" style="padding-right:0; position:relative;">
        {% if user_is_expert %}
          <div class="tg-expert-badge" title="Expert">
            <i class="fa fa-id-badge" aria-hidden="true" style="color:#403d3d; font-size:18px;"></i>
          </div>
        {% endif %}

        <div class="taxon-group-title"
             data-extra-attributes="{{ taxon_group.extra_attributes }}"
             data-taxa-upload-template="{{ taxon_group.taxa_upload_template }}"
             data-occurrence-upload-template="{{ taxon_group.occurrence_upload_template }}">
          <span class="taxon-group-name">{{ taxon_group.name }}</span>

          {% if user.is_superuser or user_is_expert %}
            <button type="button" class="btn btn-warning btn-xs update-logo-btn" title="Update logo">
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </button>
          {% endif %}
        </div>

        <div class="tg-metrics">
          <!-- Validated -->
          <div class="tg-row">
            <span class="tg-label valid">Validated</span>
            <div class="tg-chips">
              <div class="taxon-group-badge">
                <span id="taxon_group_accepted_validated_{{ taxon_group.id }}">···</span> Accepted
              </div>
              <div class="taxon-group-badge">
                <span id="taxon_group_synonym_validated_{{ taxon_group.id }}">···</span> Synonym
              </div>
            </div>
          </div>

          {% if user.is_superuser or user_is_expert %}
            <div class="tg-row" id="taxon_group_unvalidated_{{ taxon_group.id }}" style="display: none">
              <span class="tg-label unvalid">Unvalidated</span>
              <div class="tg-chips">
                <div class="taxon-group-badge">
                  <span id="taxon_group_accepted_unvalidated_{{ taxon_group.id }}">···</span> Accepted
                </div>
                <div class="taxon-group-badge">
                  <span id="taxon_group_synonym_unvalidated_{{ taxon_group.id }}">···</span> Synonym
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        {% if perms.bims.change_taxongroup %}
          <div style="margin-top:6px">
            {% if preferences.SiteSetting.enable_remove_all_occurrences_tool %}
              <span class="btn btn-danger remove-all-btn" data-module-id="{{ taxa_group.id }}">
                <i class="fa fa-trash-o" aria-hidden="true"></i> Remove All
              </span>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Recursive Include for Children -->
    {% if taxon_group.children %}
      <ul style="padding-left:0; margin-top:10px; padding-right:0;">
        {% for child in taxon_group.children %}
          {% include "_taxongroup_item.html" with taxon_group=child %}
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</li>