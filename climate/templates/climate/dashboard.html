{% extends 'main_base.html' %}
{% load static %}

{% block subtitle %}Climate dashboard{% endblock %}

{% block head %}
  <link href="{% static 'css/sass_dashboard.css' %}" rel="stylesheet">
  <link href="{% static 'css/dashboard_buttons.css' %}" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'climate/css/dashboard.css' %}">
  <script src="{% static 'js/libs/chart/Chart-2.7.2.js' %}"></script>
{% endblock %}

{% block body_content %}
<div class="body-form container climate-dashboard">
  <div class="logo hide-logo pull-right">
    <img width="50" src="{% static 'img/bims-stamp.png' %}" alt="BIMS stamp">
  </div>

  <div class="dashboard-title">
    <h2>Climate Dashboard</h2>
    <div class="dashboard-close"><i class="fa fa-times" aria-hidden="true"></i></div>
    <p class="dashboard-intro">
      View climate data records including temperature, humidity, rainfall, and wind measurements.
    </p>
  </div>

  {% if not has_data %}
    <div class="alert alert-warning">
      {{ message|default:"No climate data is available." }}
    </div>
  {% else %}
  <div class="row">
    <div class="col-md-12">
      <div class="table-container">
        <div class="table-title">Site Overview</div>
        <div class="data-content site-overview">
          <dl class="dl-horizontal climate-dl">
            <dt>Station name</dt>
            <dd>{{ site.name }}</dd>
            <dt>Station code</dt>
            <dd>{{ site.station_code }}</dd>
            <dt>Location</dt>
            <dd>{{ site.location }}</dd>
            <dt>Coordinates</dt>
            <dd>{{ site.coordinates }}</dd>
            <dt>Description</dt>
            <dd>{{ site.description }}</dd>
            <dt>Date range</dt>
            <dd>{{ date_range.start }} to {{ date_range.end }}</dd>
            <dt>Total records</dt>
            <dd>{{ total_records }}</dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <div class="vertical-space"></div>

  <div class="row">
    <div class="col-md-6">
      <div class="table-container">
        <div class="table-title">Summary Statistics</div>
        <div class="table-responsive">
          <table class="table table-striped table-bordered summary-table">
            <thead>
              <tr>
                <th>Metric</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Average Temperature</td>
                <td>{{ stats.avg_temp|floatformat:1|default:"--" }} °C</td>
              </tr>
              <tr>
                <td>Minimum Temperature</td>
                <td>{{ stats.min_temp|floatformat:1|default:"--" }} °C</td>
              </tr>
              <tr>
                <td>Maximum Temperature</td>
                <td>{{ stats.max_temp|floatformat:1|default:"--" }} °C</td>
              </tr>
              <tr>
                <td>Average Humidity</td>
                <td>{{ stats.avg_humidity|floatformat:1|default:"--" }} %</td>
              </tr>
              <tr>
                <td>Average Wind Speed</td>
                <td>{{ stats.avg_windspeed|floatformat:2|default:"--" }} m/s</td>
              </tr>
              <tr>
                <td>Total Rainfall</td>
                <td>{{ stats.total_rainfall|floatformat:2|default:"--" }} mm</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="table-container">
        <div class="table-title">Daily Climate Records</div>
        <div class="table-responsive">
          <table class="table table-striped table-bordered summary-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Avg Temp (°C)</th>
                <th>Min/Max Temp (°C)</th>
                <th>Humidity (%)</th>
                <th>Wind (m/s)</th>
                <th>Rainfall (mm)</th>
              </tr>
            </thead>
            <tbody>
              {% for record in climate_records %}
                <tr>
                  <td>{{ record.date_formatted }}</td>
                  <td>{{ record.avg_temperature|floatformat:1|default:"--" }}</td>
                  <td>{{ record.min_temperature|floatformat:1|default:"--" }} / {{ record.max_temperature|floatformat:1|default:"--" }}</td>
                  <td>{{ record.avg_humidity|floatformat:1|default:"--" }}</td>
                  <td>{{ record.avg_windspeed|floatformat:2|default:"--" }}</td>
                  <td>{{ record.daily_rainfall|floatformat:2|default:"--" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block foot %}
  {{ block.super }}
{% endblock %}
